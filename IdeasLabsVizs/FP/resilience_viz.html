<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Resilience Index – Candidate Countries vs EU-27</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: 'Segoe UI', Arial, sans-serif; background: #f4f6f9; color: #222; }
  h1 { font-size: 1.25rem; font-weight: 700; color: #003399; text-align: center; padding: 18px 20px 4px; }
  .subtitle { text-align: center; font-size: 0.82rem; color: #555; margin-bottom: 14px; }
  .container { display: flex; flex-direction: column; gap: 10px; padding: 0 20px 20px; max-width: 1300px; margin: 0 auto; }
  .card { background: #fff; border-radius: 8px; box-shadow: 0 1px 4px rgba(0,0,0,.1); padding: 16px 20px; }
  .card h2 { font-size: 0.9rem; font-weight: 600; color: #333; margin-bottom: 10px; }
  canvas { display: block; width: 100% !important; }
  .legend { display: flex; flex-wrap: wrap; gap: 8px 16px; margin-top: 10px; justify-content: center; }
  .legend-item { display: flex; align-items: center; gap: 5px; font-size: 0.75rem; }
  .legend-swatch { width: 22px; height: 3px; border-radius: 2px; flex-shrink: 0; }
  .legend-swatch.dashed { background: repeating-linear-gradient(90deg, var(--c) 0 6px, transparent 6px 10px); }
  .legend-swatch.dotted { background: repeating-linear-gradient(90deg, var(--c) 0 2px, transparent 2px 6px); }
  .note { font-size: 0.72rem; color: #888; text-align: center; margin-top: 6px; }
</style>
</head>
<body>
<h1>Resilience Index 2025 – Candidate Countries vs EU-27</h1>
<p class="subtitle">Global ranks (out of 130 countries) across overall index and 9 sub-pillars &nbsp;|&nbsp; Lower rank = better performance</p>

<div class="container">

  <!-- BUMP CHART -->
  <div class="card">
    <h2>Bump Chart — Rank Profiles Across Dimensions</h2>
    <canvas id="bumpChart" height="420"></canvas>
    <div class="legend" id="bumpLegend"></div>
    <p class="note">EU-27 Average rank = where the EU average score would place among all 130 countries. Best EU Performer = highest-scoring EU country per dimension.</p>
  </div>

  <!-- BAR CHART -->
  <div class="card">
    <h2>Bar Chart — Overall Resilience Index Rank</h2>
    <canvas id="barChart" height="260"></canvas>
    <p class="note">Bars show global rank on the overall Resilience Index. Dashed line = EU-27 Average rank. Gold dashed line = Best EU Performer rank.</p>
  </div>

</div>

<script>
const DATA = {"dims": ["Overall", "Productivity", "Health Exp.", "Political Risk", "Anti-Corruption", "Energy Intensity", "GHG Emissions", "Urbanization", "Climate Risk", "Cybersecurity"], "dims_full": ["Overall", "Productivity", "Health Expenditure", "Political Risk", "Control of Corruption", "Energy Intensity", "GHG Emissions", "Urbanization Rate", "Climate Risk Exposure", "Cybersecurity"], "series": [{"name": "Albania", "type": "candidate", "color": "#e6194b", "ranks": [82, 76, 70, 57, 76, 25, 25, 110, 83, 76], "dash": "solid"}, {"name": "Bosnia and Herzegovina", "type": "candidate", "color": "#3cb44b", "ranks": [83, 74, 56, 86, 97, 110, 109, 94, 48, 123], "dash": "solid"}, {"name": "Georgia", "type": "candidate", "color": "#4363d8", "ranks": [62, 65, 62, 83, 43, 79, 52, 86, 29, 52], "dash": "solid"}, {"name": "Moldova", "type": "candidate", "color": "#f58231", "ranks": [87, 82, 80, 108, 72, 94, 88, 68, 55, 107], "dash": "solid"}, {"name": "Montenegro", "type": "candidate", "color": "#911eb4", "ranks": [63, 60, 43, 63, 67, 69, 80, 71, 41, 94], "dash": "solid"}, {"name": "North Macedonia", "type": "candidate", "color": "#42d4f4", "ranks": [71, 66, 58, 58, 78, 66, 61, 78, 44, 102], "dash": "solid"}, {"name": "Serbia", "type": "candidate", "color": "#f032e6", "ranks": [61, 62, 52, 71, 85, 97, 80, 61, 82, 21], "dash": "solid"}, {"name": "T\u00fcrkiye", "type": "candidate", "color": "#bfef45", "ranks": [53, 55, 63, 118, 91, 33, 44, 75, 21, 38], "dash": "solid"}, {"name": "Ukraine", "type": "candidate", "color": "#fabed4", "ranks": [79, 80, 81, 122, 102, 113, 95, 34, 59, 81], "dash": "solid"}, {"name": "EU-27 Average", "type": "eu_avg", "color": "#003399", "ranks": [25, 25, 23, 34, 31, 59, 24, 49, 75, 63], "dash": "dashed"}, {"name": "Best EU Performer", "type": "best_eu", "color": "#FFD700", "ranks": [1, 1, 1, 5, 1, 4, 2, 5, 4, 6], "dash": "dotted"}], "max_rank": 128, "total_countries": 130};

// ── Utility ────────────────────────────────────────────────────────────────
function hexToRgba(hex, alpha) {
  const r = parseInt(hex.slice(1,3),16);
  const g = parseInt(hex.slice(3,5),16);
  const b = parseInt(hex.slice(5,7),16);
  return `rgba(${r},${g},${b},${alpha})`;
}

// ── BUMP CHART ─────────────────────────────────────────────────────────────
(function() {
  const canvas = document.getElementById('bumpChart');
  const W = canvas.parentElement.clientWidth - 40;
  const H = 420;
  canvas.width = W;
  canvas.height = H;
  const ctx = canvas.getContext('2d');

  const PAD = { top: 30, right: 20, bottom: 60, left: 54 };
  const plotW = W - PAD.left - PAD.right;
  const plotH = H - PAD.top - PAD.bottom;

  const dims = DATA.dims;
  const nDims = dims.length;
  const maxRank = DATA.max_rank;

  function xPos(i) { return PAD.left + (i / (nDims - 1)) * plotW; }
  function yPos(rank) { return PAD.top + ((rank - 1) / (maxRank - 1)) * plotH; }

  // Grid lines
  ctx.strokeStyle = '#e8e8e8';
  ctx.lineWidth = 1;
  const yTicks = [1, 20, 40, 60, 80, 100, 120].filter(t => t <= maxRank + 5);
  yTicks.forEach(t => {
    const y = yPos(t);
    ctx.beginPath();
    ctx.moveTo(PAD.left, y);
    ctx.lineTo(W - PAD.right, y);
    ctx.stroke();
    ctx.fillStyle = '#999';
    ctx.font = '10px Segoe UI';
    ctx.textAlign = 'right';
    ctx.fillText(t, PAD.left - 6, y + 3.5);
  });

  // Y-axis label
  ctx.save();
  ctx.translate(12, PAD.top + plotH / 2);
  ctx.rotate(-Math.PI / 2);
  ctx.fillStyle = '#666';
  ctx.font = '11px Segoe UI';
  ctx.textAlign = 'center';
  ctx.fillText('Global Rank (1 = best)', 0, 0);
  ctx.restore();

  // X-axis labels
  dims.forEach((d, i) => {
    const x = xPos(i);
    ctx.fillStyle = '#444';
    ctx.font = i === 0 ? 'bold 11px Segoe UI' : '10px Segoe UI';
    ctx.textAlign = 'center';
    // Wrap long labels
    const words = d.split(' ');
    if (words.length > 1 && d.length > 10) {
      ctx.fillText(words[0], x, H - PAD.bottom + 14);
      ctx.fillText(words.slice(1).join(' '), x, H - PAD.bottom + 26);
    } else {
      ctx.fillText(d, x, H - PAD.bottom + 18);
    }
    // Vertical tick
    ctx.strokeStyle = '#ccc';
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.moveTo(x, PAD.top);
    ctx.lineTo(x, PAD.top + plotH);
    ctx.stroke();
  });

  // Draw series
  DATA.series.forEach(s => {
    const ranks = s.ranks;
    ctx.beginPath();
    ctx.lineWidth = s.type === 'candidate' ? 2 : 3;
    ctx.strokeStyle = s.color;
    if (s.dash === 'dashed') ctx.setLineDash([8, 4]);
    else if (s.dash === 'dotted') ctx.setLineDash([2, 4]);
    else ctx.setLineDash([]);

    ranks.forEach((r, i) => {
      const x = xPos(i);
      const y = yPos(r);
      if (i === 0) ctx.moveTo(x, y);
      else ctx.lineTo(x, y);
    });
    ctx.stroke();
    ctx.setLineDash([]);

    // Dots
    ranks.forEach((r, i) => {
      const x = xPos(i);
      const y = yPos(r);
      ctx.beginPath();
      ctx.arc(x, y, s.type === 'candidate' ? 3.5 : 5, 0, Math.PI * 2);
      ctx.fillStyle = s.color;
      ctx.fill();
      ctx.strokeStyle = '#fff';
      ctx.lineWidth = 1.5;
      ctx.stroke();
    });

    // Rank label at last point
    const lastX = xPos(nDims - 1) + 6;
    const lastY = yPos(ranks[nDims - 1]);
    ctx.fillStyle = s.color;
    ctx.font = 'bold 9px Segoe UI';
    ctx.textAlign = 'left';
    ctx.fillText(ranks[nDims - 1], lastX, lastY + 3);
  });

  // Legend
  const legendEl = document.getElementById('bumpLegend');
  DATA.series.forEach(s => {
    const item = document.createElement('div');
    item.className = 'legend-item';
    const swatch = document.createElement('div');
    swatch.className = 'legend-swatch';
    swatch.style.setProperty('--c', s.color);
    swatch.style.background = s.dash === 'solid' ? s.color : '';
    if (s.dash === 'dashed') swatch.style.background = `repeating-linear-gradient(90deg, ${s.color} 0 6px, transparent 6px 10px)`;
    if (s.dash === 'dotted') swatch.style.background = `repeating-linear-gradient(90deg, ${s.color} 0 2px, transparent 2px 6px)`;
    swatch.style.height = '3px';
    swatch.style.width = '22px';
    const label = document.createElement('span');
    label.textContent = s.name;
    item.appendChild(swatch);
    item.appendChild(label);
    legendEl.appendChild(item);
  });
})();

// ── BAR CHART ──────────────────────────────────────────────────────────────
(function() {
  const canvas = document.getElementById('barChart');
  const W = canvas.parentElement.clientWidth - 40;
  const H = 260;
  canvas.width = W;
  canvas.height = H;
  const ctx = canvas.getContext('2d');

  // Only candidate countries + EU avg + best EU for overall rank
  const series = DATA.series;
  const overallIdx = 0;
  const entries = series.map(s => ({ name: s.name, rank: s.ranks[overallIdx], color: s.color, type: s.type }));

  const PAD = { top: 20, right: 20, bottom: 80, left: 54 };
  const plotW = W - PAD.left - PAD.right;
  const plotH = H - PAD.top - PAD.bottom;

  const maxRank = Math.max(...entries.map(e => e.rank)) + 5;

  function yPos(rank) { return PAD.top + ((rank - 1) / (maxRank - 1)) * plotH; }
  function barH(rank) { return plotH - ((rank - 1) / (maxRank - 1)) * plotH; }

  // Only bar for candidates
  const barEntries = entries.filter(e => e.type === 'candidate');
  const barW = Math.min(40, plotW / barEntries.length - 8);
  const spacing = plotW / barEntries.length;

  // Grid
  const yTicks = [1, 20, 40, 60, 80, 100];
  ctx.strokeStyle = '#e8e8e8';
  ctx.lineWidth = 1;
  yTicks.forEach(t => {
    const y = yPos(t);
    ctx.beginPath();
    ctx.moveTo(PAD.left, y);
    ctx.lineTo(W - PAD.right, y);
    ctx.stroke();
    ctx.fillStyle = '#999';
    ctx.font = '10px Segoe UI';
    ctx.textAlign = 'right';
    ctx.fillText(t, PAD.left - 6, y + 3.5);
  });

  // Y-axis label
  ctx.save();
  ctx.translate(12, PAD.top + plotH / 2);
  ctx.rotate(-Math.PI / 2);
  ctx.fillStyle = '#666';
  ctx.font = '11px Segoe UI';
  ctx.textAlign = 'center';
  ctx.fillText('Global Rank', 0, 0);
  ctx.restore();

  // EU avg reference line
  const euAvg = entries.find(e => e.type === 'eu_avg');
  if (euAvg) {
    const y = yPos(euAvg.rank);
    ctx.strokeStyle = '#003399';
    ctx.lineWidth = 2;
    ctx.setLineDash([8, 4]);
    ctx.beginPath();
    ctx.moveTo(PAD.left, y);
    ctx.lineTo(W - PAD.right, y);
    ctx.stroke();
    ctx.setLineDash([]);
    ctx.fillStyle = '#003399';
    ctx.font = 'bold 9px Segoe UI';
    ctx.textAlign = 'right';
    ctx.fillText(`EU-27 Avg (rank ${euAvg.rank})`, W - PAD.right - 4, y - 4);
  }

  // Best EU reference line
  const bestEu = entries.find(e => e.type === 'best_eu');
  if (bestEu) {
    const y = yPos(bestEu.rank);
    ctx.strokeStyle = '#b8860b';
    ctx.lineWidth = 2;
    ctx.setLineDash([4, 3]);
    ctx.beginPath();
    ctx.moveTo(PAD.left, y);
    ctx.lineTo(W - PAD.right, y);
    ctx.stroke();
    ctx.setLineDash([]);
    ctx.fillStyle = '#b8860b';
    ctx.font = 'bold 9px Segoe UI';
    ctx.textAlign = 'right';
    ctx.fillText(`Best EU (rank ${bestEu.rank})`, W - PAD.right - 4, y - 4);
  }

  // Bars
  barEntries.forEach((e, i) => {
    const x = PAD.left + i * spacing + spacing / 2 - barW / 2;
    const bh = barH(e.rank);
    const y = PAD.top + plotH - bh;
    ctx.fillStyle = hexToRgba(e.color, 0.85);
    ctx.fillRect(x, y, barW, bh);
    ctx.strokeStyle = e.color;
    ctx.lineWidth = 1.5;
    ctx.strokeRect(x, y, barW, bh);

    // Rank label on top of bar
    ctx.fillStyle = '#333';
    ctx.font = 'bold 11px Segoe UI';
    ctx.textAlign = 'center';
    ctx.fillText(e.rank, x + barW / 2, y - 4);

    // Country label below
    const words = e.name.split(' ');
    ctx.fillStyle = '#444';
    ctx.font = '9px Segoe UI';
    let labelY = PAD.top + plotH + 14;
    if (words.length <= 2) {
      ctx.fillText(e.name, x + barW / 2, labelY);
    } else {
      // Split at midpoint
      const mid = Math.ceil(words.length / 2);
      ctx.fillText(words.slice(0, mid).join(' '), x + barW / 2, labelY);
      ctx.fillText(words.slice(mid).join(' '), x + barW / 2, labelY + 12);
    }
  });
})();
</script>
</body>
</html>
