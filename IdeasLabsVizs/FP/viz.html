<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Resilience Index 2025 – Selected Indicators</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #ffffff;
            color: #111;
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Helvetica, Arial, sans-serif;
            height: 100vh;
        }

        .viz-grid {
            display: grid;
            grid-template-rows: 1fr auto;
            grid-template-columns: 1fr;
            height: 100vh;
            width: 100vw;
            box-sizing: border-box;
            padding-bottom: clamp(8px, 2vh, 18px);
            padding-top: 2px;
            padding-left: 2px;
        }

        #container1 {
            grid-row: 1;
            grid-column: 1;
            display: flex;
            overflow: hidden;
            min-height: 0;
            column-gap: 0;
            justify-content: center;
        }

        .inner-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 0px;
            width: 100%;
            height: 100%;

            box-sizing: border-box;
        }

        .panel {
            background: #fff;
            border-radius: 8px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .panel:first-child {
            grid-column: span 2;
            grid-row: span 2;
            border-right: 1px solid #e2e2e2;
            border-bottom: 1px solid #e2e2e2;
        }

        .panel h3 {
            font-size: 0.9rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
            text-align: center;
            flex-shrink: 0;
        }

        .panel svg {
            display: block;
            width: 100%;
            flex: 1;
            height: auto;
            min-height: 0;
            overflow: visible;
        }

        #container2 {
            grid-row: 2;
            grid-column: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            font-size: clamp(8px, 1.6vw, 16px);
            padding-top: 10px;
        }

        .legend-ref {
            width: 20px;
            height: 2px;
            border-top: 2px dashed #b8860b;
        }

        @media (max-height: 500px) {
            .viz-grid {
                grid-template-rows: 1fr;
                padding-bottom: 0;
            }

            #container2 {
                display: none !important;
            }
        }

        .shiny-bar {
            fill: url(#gold-shine) !important;
        }
    </style>
</head>

<body>

    <svg style="position: absolute; width: 0; height: 0; overflow: hidden;" aria-hidden="true">
        <defs>
            <linearGradient id="gold-shine" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#d4af37; stop-opacity:1" />
                <stop offset="100%" style="stop-color:#b8860b; stop-opacity:1" />
            </linearGradient>
        </defs>
    </svg>

    <div class="viz-grid">
        <div id="container1">
            <div class="inner-grid" id="grid"></div>
        </div>
        <div id="container2">
            <div class="legend" id="legend"></div>
        </div>
    </div>

    <script>
        const COLORS = {
            "Albania": "#c11220", //ready
            "Bosnia and Herzegovina": "#a97155", //ready
            "Georgia": "#00909e", //ready
            "Moldova": "#53a548", //ready
            "Montenegro": "#8e44ad", //ready
            "North Macedonia": "#106723", //ready
            "Serbia": "#2e294e",//ready
            "Türkiye": "#6c7a7b", //ready
            "Ukraine": "#f1c40e", //ready
            "EU-27 Average": "#003399"
        };
        const GOLD_COLOR = "#b8860b";

        const PANELS = [
            {
                "dim": "Overall", "label": "Overall Index",
                "bars": [
                    { "country": "Albania", "abbr": "ALB", "rank": 82, "color": "#e6194b", "isEU": false },
                    { "country": "Bosnia and Herzegovina", "abbr": "BiH", "rank": 83, "color": "#3cb44b", "isEU": false },
                    { "country": "Georgia", "abbr": "GEO", "rank": 62, "color": "#4363d8", "isEU": false },
                    { "country": "Moldova", "abbr": "MDA", "rank": 87, "color": "#f58231", "isEU": false },
                    { "country": "Montenegro", "abbr": "MNE", "rank": 63, "color": "#911eb4", "isEU": false },
                    { "country": "North Macedonia", "abbr": "MKD", "rank": 71, "color": "#42d4f4", "isEU": false },
                    { "country": "Serbia", "abbr": "SRB", "rank": 61, "color": "#f032e6", "isEU": false },
                    { "country": "Türkiye", "abbr": "TUR", "rank": 53, "color": "#a9a900", "isEU": false },
                    { "country": "Ukraine", "abbr": "UKR", "rank": 79, "color": "#fabed4", "isEU": false },
                    { "country": "EU-27 Average", "abbr": "EU", "rank": 25, "color": "#003399", "isEU": true }
                ],
                "bestEURank": 1, "bestEUCountry": "Denmark"
            },
            {
                "dim": "Productivity", "label": "Productivity",
                "bars": [
                    { "country": "Albania", "abbr": "ALB", "rank": 76, "color": "#e6194b", "isEU": false },
                    { "country": "Bosnia and Herzegovina", "abbr": "BiH", "rank": 74, "color": "#3cb44b", "isEU": false },
                    { "country": "Georgia", "abbr": "GEO", "rank": 65, "color": "#4363d8", "isEU": false },
                    { "country": "Moldova", "abbr": "MDA", "rank": 82, "color": "#f58231", "isEU": false },
                    { "country": "Montenegro", "abbr": "MNE", "rank": 60, "color": "#911eb4", "isEU": false },
                    { "country": "North Macedonia", "abbr": "MKD", "rank": 66, "color": "#42d4f4", "isEU": false },
                    { "country": "Serbia", "abbr": "SRB", "rank": 62, "color": "#f032e6", "isEU": false },
                    { "country": "Türkiye", "abbr": "TUR", "rank": 55, "color": "#a9a900", "isEU": false },
                    { "country": "Ukraine", "abbr": "UKR", "rank": 80, "color": "#fabed4", "isEU": false },
                    { "country": "EU-27 Average", "abbr": "EU", "rank": 25, "color": "#003399", "isEU": true }
                ],
                "bestEURank": 1, "bestEUCountry": "Luxembourg"
            },
            {
                "dim": "Cybersecurity", "label": "Cybersecurity",
                "bars": [
                    { "country": "Albania", "abbr": "ALB", "rank": 76, "color": "#e6194b", "isEU": false },
                    { "country": "Bosnia and Herzegovina", "abbr": "BiH", "rank": 123, "color": "#3cb44b", "isEU": false },
                    { "country": "Georgia", "abbr": "GEO", "rank": 52, "color": "#4363d8", "isEU": false },
                    { "country": "Moldova", "abbr": "MDA", "rank": 107, "color": "#f58231", "isEU": false },
                    { "country": "Montenegro", "abbr": "MNE", "rank": 94, "color": "#911eb4", "isEU": false },
                    { "country": "North Macedonia", "abbr": "MKD", "rank": 102, "color": "#42d4f4", "isEU": false },
                    { "country": "Serbia", "abbr": "SRB", "rank": 21, "color": "#f032e6", "isEU": false },
                    { "country": "Türkiye", "abbr": "TUR", "rank": 38, "color": "#a9a900", "isEU": false },
                    { "country": "Ukraine", "abbr": "UKR", "rank": 81, "color": "#fabed4", "isEU": false },
                    { "country": "EU-27 Average", "abbr": "EU", "rank": 63, "color": "#003399", "isEU": true }
                ],
                "bestEURank": 6, "bestEUCountry": "Greece"
            },
            {
                "dim": "Energy Intensity", "label": "Energy Intensity",
                "bars": [
                    { "country": "Albania", "abbr": "ALB", "rank": 25, "color": "#e6194b", "isEU": false },
                    { "country": "Bosnia and Herzegovina", "abbr": "BiH", "rank": 110, "color": "#3cb44b", "isEU": false },
                    { "country": "Georgia", "abbr": "GEO", "rank": 79, "color": "#4363d8", "isEU": false },
                    { "country": "Moldova", "abbr": "MDA", "rank": 94, "color": "#f58231", "isEU": false },
                    { "country": "Montenegro", "abbr": "MNE", "rank": 69, "color": "#911eb4", "isEU": false },
                    { "country": "North Macedonia", "abbr": "MKD", "rank": 66, "color": "#42d4f4", "isEU": false },
                    { "country": "Serbia", "abbr": "SRB", "rank": 97, "color": "#f032e6", "isEU": false },
                    { "country": "Türkiye", "abbr": "TUR", "rank": 33, "color": "#a9a900", "isEU": false },
                    { "country": "Ukraine", "abbr": "UKR", "rank": 113, "color": "#fabed4", "isEU": false },
                    { "country": "EU-27 Average", "abbr": "EU", "rank": 59, "color": "#003399", "isEU": true }
                ],
                "bestEURank": 4, "bestEUCountry": "Ireland"
            },
            {
                "dim": "Political Risk", "label": "Political Risk",
                "bars": [
                    { "country": "Albania", "abbr": "ALB", "rank": 57, "color": "#e6194b", "isEU": false },
                    { "country": "Bosnia and Herzegovina", "abbr": "BiH", "rank": 86, "color": "#3cb44b", "isEU": false },
                    { "country": "Georgia", "abbr": "GEO", "rank": 83, "color": "#4363d8", "isEU": false },
                    { "country": "Moldova", "abbr": "MDA", "rank": 108, "color": "#f58231", "isEU": false },
                    { "country": "Montenegro", "abbr": "MNE", "rank": 63, "color": "#911eb4", "isEU": false },
                    { "country": "North Macedonia", "abbr": "MKD", "rank": 58, "color": "#42d4f4", "isEU": false },
                    { "country": "Serbia", "abbr": "SRB", "rank": 71, "color": "#f032e6", "isEU": false },
                    { "country": "Türkiye", "abbr": "TUR", "rank": 118, "color": "#a9a900", "isEU": false },
                    { "country": "Ukraine", "abbr": "UKR", "rank": 122, "color": "#fabed4", "isEU": false },
                    { "country": "EU-27 Average", "abbr": "EU", "rank": 34, "color": "#003399", "isEU": true }
                ],
                "bestEURank": 5, "bestEUCountry": "Luxembourg"
            },
            {
                "dim": "Urbanization Rate", "label": "Urbanization Rate",
                "bars": [
                    { "country": "Albania", "abbr": "ALB", "rank": 110, "color": "#e6194b", "isEU": false },
                    { "country": "Bosnia and Herzegovina", "abbr": "BiH", "rank": 94, "color": "#3cb44b", "isEU": false },
                    { "country": "Georgia", "abbr": "GEO", "rank": 86, "color": "#4363d8", "isEU": false },
                    { "country": "Moldova", "abbr": "MDA", "rank": 68, "color": "#f58231", "isEU": false },
                    { "country": "Montenegro", "abbr": "MNE", "rank": 71, "color": "#911eb4", "isEU": false },
                    { "country": "North Macedonia", "abbr": "MKD", "rank": 78, "color": "#42d4f4", "isEU": false },
                    { "country": "Serbia", "abbr": "SRB", "rank": 61, "color": "#f032e6", "isEU": false },
                    { "country": "Türkiye", "abbr": "TUR", "rank": 75, "color": "#a9a900", "isEU": false },
                    { "country": "Ukraine", "abbr": "UKR", "rank": 34, "color": "#fabed4", "isEU": false },
                    { "country": "EU-27 Average", "abbr": "EU", "rank": 49, "color": "#003399", "isEU": true }
                ],
                "bestEURank": 5, "bestEUCountry": "Belgium"
            },
            {
                "dim": "Control of Corruption", "label": "Control of Corruption",
                "bars": [
                    { "country": "Albania", "abbr": "ALB", "rank": 76, "color": "#e6194b", "isEU": false },
                    { "country": "Bosnia and Herzegovina", "abbr": "BiH", "rank": 97, "color": "#3cb44b", "isEU": false },
                    { "country": "Georgia", "abbr": "GEO", "rank": 43, "color": "#4363d8", "isEU": false },
                    { "country": "Moldova", "abbr": "MDA", "rank": 72, "color": "#f58231", "isEU": false },
                    { "country": "Montenegro", "abbr": "MNE", "rank": 67, "color": "#911eb4", "isEU": false },
                    { "country": "North Macedonia", "abbr": "MKD", "rank": 78, "color": "#42d4f4", "isEU": false },
                    { "country": "Serbia", "abbr": "SRB", "rank": 85, "color": "#f032e6", "isEU": false },
                    { "country": "Türkiye", "abbr": "TUR", "rank": 91, "color": "#a9a900", "isEU": false },
                    { "country": "Ukraine", "abbr": "UKR", "rank": 102, "color": "#fabed4", "isEU": false },
                    { "country": "EU-27 Average", "abbr": "EU", "rank": 31, "color": "#003399", "isEU": true }
                ],
                "bestEURank": 1, "bestEUCountry": "Denmark"
            },
            {
                "dim": "Climate Risk Exposure", "label": "Climate Risk Exposure",
                "bars": [
                    { "country": "Albania", "abbr": "ALB", "rank": 83, "color": "#e6194b", "isEU": false },
                    { "country": "Bosnia and Herzegovina", "abbr": "BiH", "rank": 48, "color": "#3cb44b", "isEU": false },
                    { "country": "Georgia", "abbr": "GEO", "rank": 29, "color": "#4363d8", "isEU": false },
                    { "country": "Moldova", "abbr": "MDA", "rank": 55, "color": "#f58231", "isEU": false },
                    { "country": "Montenegro", "abbr": "MNE", "rank": 41, "color": "#911eb4", "isEU": false },
                    { "country": "North Macedonia", "abbr": "MKD", "rank": 44, "color": "#42d4f4", "isEU": false },
                    { "country": "Serbia", "abbr": "SRB", "rank": 82, "color": "#f032e6", "isEU": false },
                    { "country": "Türkiye", "abbr": "TUR", "rank": 21, "color": "#a9a900", "isEU": false },
                    { "country": "Ukraine", "abbr": "UKR", "rank": 59, "color": "#fabed4", "isEU": false },
                    { "country": "EU-27 Average", "abbr": "EU", "rank": 75, "color": "#003399", "isEU": true }
                ],
                "bestEURank": 4, "bestEUCountry": "Malta"
            },
            {
                "dim": "Health Expenditure", "label": "Health Expenditure",
                "bars": [
                    { "country": "Albania", "abbr": "ALB", "rank": 70, "color": "#e6194b", "isEU": false },
                    { "country": "Bosnia and Herzegovina", "abbr": "BiH", "rank": 56, "color": "#3cb44b", "isEU": false },
                    { "country": "Georgia", "abbr": "GEO", "rank": 62, "color": "#4363d8", "isEU": false },
                    { "country": "Moldova", "abbr": "MDA", "rank": 80, "color": "#f58231", "isEU": false },
                    { "country": "Montenegro", "abbr": "MNE", "rank": 43, "color": "#911eb4", "isEU": false },
                    { "country": "North Macedonia", "abbr": "MKD", "rank": 58, "color": "#42d4f4", "isEU": false },
                    { "country": "Serbia", "abbr": "SRB", "rank": 52, "color": "#f032e6", "isEU": false },
                    { "country": "Türkiye", "abbr": "TUR", "rank": 63, "color": "#a9a900", "isEU": false },
                    { "country": "Ukraine", "abbr": "UKR", "rank": 81, "color": "#fabed4", "isEU": false },
                    { "country": "EU-27 Average", "abbr": "EU", "rank": 23, "color": "#003399", "isEU": true }
                ],
                "bestEURank": 1, "bestEUCountry": "Croatia"
            }
        ];

        const Y_MIN = 1;
        const Y_MAX = 130;

        const gridEl = document.getElementById('grid');
        function roundedRightRectPath(x, y, w, h, r) {
            const rr = Math.min(r, w / 2, h / 2);
            if (w <= 0) return "";
            return `M ${x},${y} 
                    L ${x + w - rr},${y} 
                    Q ${x + w},${y} ${x + w},${y + rr} 
                    L ${x + w},${y + h - rr} 
                    Q ${x + w},${y + h} ${x + w - rr},${y + h} 
                    L ${x},${y + h} 
                    Z`;
        }

        PANELS.forEach((panel) => {
            const sortedBars = [...panel.bars];
            sortedBars.push({
                country: panel.bestEUCountry,
                rank: panel.bestEURank,
                color: GOLD_COLOR,
                isEU: false
            });

            sortedBars.sort((a, b) => a.rank - b.rank);

            const wrapper = document.createElement('div');
            wrapper.className = 'panel';

            const bars = sortedBars;
            const nBars = bars.length;

            const svgH = 580;
            const padL = 220;
            const padR = 55;
            const padT = 120;
            const padB = 4;

            const plotH = svgH - padT - padB;
            const svgW = 800;
            const calcPlotW = svgW - padL - padR;

            const bGap = 10;
            const bH = (plotH - (nBars - 1) * bGap) / nBars;

            function barW(rank) {
                const maxScore = 135 - 1;
                const score = 135 - rank;
                return (score / maxScore) * calcPlotW;
            }

            function xPx(rank) {
                const score = 135 - rank;
                return padL + (score / 135) * calcPlotW;
            }

            const svgNS = 'http://www.w3.org/2000/svg';
            const svg = document.createElementNS(svgNS, 'svg');
            svg.setAttribute('viewBox', `0 0 ${svgW} ${svgH}`);
            svg.setAttribute('preserveAspectRatio', 'xMidYMid meet');
            svg.style.fontFamily = 'inherit';


            bars.forEach((bar, i) => {
                const y = padT + i * (bH + bGap);
                const fullWidth = barW(1);
                const bgPathD = roundedRightRectPath(padL, y, fullWidth, bH, 3);
                const bgPath = document.createElementNS(svgNS, 'path');
                bgPath.setAttribute('d', bgPathD);
                bgPath.setAttribute('fill', bar.isEU ? '#a7b8d3' : '#e6e6e6');
                svg.appendChild(bgPath);

                const width = barW(bar.rank);
                const pathD = roundedRightRectPath(padL, y, width, bH, 3);

                const fillColor = COLORS[bar.country] || bar.color || '#999';

                const path = document.createElementNS(svgNS, 'path');
                path.setAttribute('d', pathD);

                if (bar.color === GOLD_COLOR) {
                    path.setAttribute('class', 'shiny-bar');
                } else {
                    path.setAttribute('fill', fillColor);
                }

                path.setAttribute('fill-opacity', bar.isEU ? '1' : '0.82');
                svg.appendChild(path);

                if (bar.isEU) {
                    const borderPath = document.createElementNS(svgNS, 'path');
                    const bPathD = roundedRightRectPath(padL, y - 1, width + 1, bH + 2, 3.5);
                    borderPath.setAttribute('d', bPathD);
                    borderPath.setAttribute('fill', 'none');
                    borderPath.setAttribute('stroke', '#001f80');
                    borderPath.setAttribute('stroke-width', '1.5');
                    borderPath.setAttribute('stroke-linejoin', 'round');
                    svg.appendChild(borderPath);
                }

                const nameTxt = document.createElementNS(svgNS, 'text');
                nameTxt.setAttribute('x', padL - 10);
                nameTxt.setAttribute('y', y + bH / 2 + 5);
                nameTxt.setAttribute('text-anchor', 'end');
                nameTxt.setAttribute('font-size', '14.5');
                nameTxt.setAttribute('font-weight', '500');
                if (bar.isEU) {
                    nameTxt.setAttribute('fill', COLORS["EU-27 Average"]);
                    nameTxt.setAttribute('font-weight', 'bold');
                } else {
                    nameTxt.setAttribute('fill', '#333');
                }

                nameTxt.textContent = bar.country;
                svg.appendChild(nameTxt);

                const rankTxt = document.createElementNS(svgNS, 'text');
                rankTxt.setAttribute('x', padL + width + 8);
                rankTxt.setAttribute('y', y + bH / 2 + 5);
                rankTxt.setAttribute('text-anchor', 'start');
                rankTxt.setAttribute('font-size', '14.5');
                rankTxt.setAttribute('font-weight', 'bold');
                rankTxt.setAttribute('font-style', 'italic');
                rankTxt.setAttribute('fill', bar.isEU ? '#ffffff' : '#111');
                rankTxt.textContent = '#' + bar.rank;
                svg.appendChild(rankTxt);

                if (bar.color === GOLD_COLOR) {
                    const bestEuTxt = document.createElementNS(svgNS, 'text');
                    bestEuTxt.setAttribute('x', padL);
                    bestEuTxt.setAttribute('y', y - 5);
                    bestEuTxt.setAttribute('text-anchor', 'start');
                    bestEuTxt.setAttribute('font-size', '11');
                    bestEuTxt.setAttribute('font-weight', 'bold');
                    bestEuTxt.setAttribute('font-style', 'italic');
                    bestEuTxt.setAttribute('fill', GOLD_COLOR);
                    bestEuTxt.setAttribute('stroke', '#fff');
                    bestEuTxt.setAttribute('stroke-width', '2.5');
                    bestEuTxt.setAttribute('stroke-linejoin', 'round');
                    bestEuTxt.setAttribute('paint-order', 'stroke');
                    bestEuTxt.textContent = "Best EU Performer";
                    svg.appendChild(bestEuTxt);
                }
            });

            const titleY = 50;

            const isOverall = (panel.label === "Overall Index");
            const fontSize = isOverall ? '40' : '32';
            const titleFill = '#111';

            const titleTxt = document.createElementNS(svgNS, 'text');
            titleTxt.setAttribute('class', 'panel-title');
            titleTxt.setAttribute('x', padL + 12);
            titleTxt.setAttribute('y', titleY + 10);
            titleTxt.setAttribute('text-anchor', 'start');
            titleTxt.setAttribute('font-size', fontSize);
            titleTxt.setAttribute('font-weight', '800');
            titleTxt.setAttribute('fill', titleFill);
            titleTxt.textContent = panel.label;
            svg.appendChild(titleTxt);

            const tick = document.createElementNS(svgNS, 'line');
            tick.setAttribute('x1', padL);
            tick.setAttribute('x2', padL + 10);
            tick.setAttribute('y1', titleY);
            tick.setAttribute('y2', titleY);
            tick.setAttribute('stroke', '#000');
            tick.setAttribute('stroke-width', '2');
            svg.appendChild(tick);

            const yAxis = document.createElementNS(svgNS, 'line');
            yAxis.setAttribute('x1', padL);
            yAxis.setAttribute('x2', padL);
            yAxis.setAttribute('y1', titleY);
            yAxis.setAttribute('y2', padT + plotH);
            yAxis.setAttribute('stroke', '#000');
            yAxis.setAttribute('stroke-width', '1');
            svg.appendChild(yAxis);

            wrapper.appendChild(svg);
            gridEl.appendChild(wrapper);
        });
        const legendEl = document.getElementById('legend');
        legendEl.style.display = 'none';
    </script>
</body>

</html>