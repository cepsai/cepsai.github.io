<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
  :root{--bg:#ffffff;--axis:#cfcfcf;--grid:#e9e9e9;--text:#6b6b6b;--text-strong:#333333;--muted:#9aa0a6;}

  html, body {
    margin: 0;
    height: 100%;
    width: 100%;
    background: var(--bg);
    font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
    color: var(--text);
    overflow: hidden;
  }
  .viz-grid {
    display: flex;
    flex-direction: column;
    height: 100%;
    width: 100%;
  }
  #container1 {
    flex: 17;
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 0;
    padding: 0;
  }
  #container2 {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 6px 12px;
    background: #fff;
  }
  #container3 {
    flex: 1;
    display: flex;
    flex-direction: row;
    align-items: center;
    padding: 6px 12px;
    background: #fff;
  }

  @media (max-width: 600px) {
    #container2, #container3 {
      display: none;
    }

    #container1 {
      flex: 1;
    }
  }
  #source-container {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: flex-start;
  }

  #logo-container {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: flex-end;
  }
  #chart {
    width: 100%;
    height: 100%;
    min-width: 0;
    min-height: 0;
  }
  .custom-legend {
    background: #fff;
    border: 1px solid #eee;
    border-radius: 10px;
    padding: 6px 10px;
    display: flex;
    gap: 12px;
    align-items: center;
    justify-content: center;
  }

  .legend-item {
    display: flex;
    align-items: center;
    gap: 6px;
    font-weight: 600;
    color: #333;
  }

  .legend-square {
    width: 14px;
    height: 14px;
    border-radius: 3px;
    box-shadow: 0 0 0 1px rgba(0,0,0,0.15) inset;
  }

  .axis{font-size:12px;color:var(--text);}
  .axis path,.axis line{stroke:var(--axis);}
  .grid line{stroke:var(--grid);stroke-opacity:0.7;}
  .axis-title{font-size:14px;font-weight:600;fill:var(--text-strong);}

  .dot{cursor:pointer;transition:opacity 0.2s;}
  .dot-ring{fill:#fff;}
  .dot-label{font-size:10px;fill:#333;pointer-events:none;text-anchor:middle;font-weight:700;}
  .connection-line{pointer-events:none;}
  @media (max-width: 600px) {
    .dot-label {
      font-size: 4px;
    }
  }

  .tooltip{
    position:absolute;background:#fff;border:1px solid #e5e5e5;border-radius:8px;
    padding:12px;box-shadow:0 10px 24px rgba(0,0,0,.1);pointer-events:none;opacity:0;
    transition:opacity 0.2s;font-size:12px;
  }
  .tooltip-title{font-weight:700;font-size:13px;color:var(--text-strong);margin-bottom:6px;}
  .tooltip-table{width:100%;}
  .tooltip-table td{padding:2px 8px 2px 0;}
  .tooltip-table .title{color:var(--text);font-weight:600;}
  .tooltip-table .data{color:var(--text-strong);}
  .logo{
    width:clamp(80px,10vw,120px);
    pointer-events:auto; opacity:1; transition:opacity .3s ease;
  }
  .source-text{
    font-size:clamp(10px,1.2vw,14px); font-weight:bold; font-style:italic;
    color:#555;
  }
  </style>
</head>
<body>
  <div class="viz-grid">
    <div id="container1"><div id="chart"></div></div>
    <div id="container2"><div id="legend" class="custom-legend"></div></div>
    <div id="container3">
      <div id="source-container">
        <div class="source-text">
          Source: <a href="https://scale.com/leaderboard/humanitys_last_exam_text_only" target="_blank" rel="noopener">Scale AI & </a><a href="https://moonshotai.github.io/Kimi-K2/thinking.html" target="_blank" rel="noopener">Moonshot AI & </a><a href="https://blog.google/products/gemini/gemini-3/#gemini-3-deep-think" target="_blank" rel="noopener">Google</a>
        </div>
      </div>
      <div id="logo-container">
        <a href="https://aiworld.eu/" target="_blank" rel="noopener">
          <img src="https://aiworld.eu/logo-transparent.svg" class="logo" alt="AI World logo">
        </a>
      </div>
    </div>
  </div>
  <div id="tooltip" class="tooltip"></div>

<script>
  const TYPE_COLOR_MAP = { open:"#2E7D32" , closed:  "#333"}; 
  const LOGO_MAP = {
    "OpenAI": "Openai.webp",
    "DeepSeek": "Deepseek.png",
    "Google": "Google.png",
    "Alibaba Qwen": "Qwen.webp",
    "Moonshot AI": "moonshot.png",
  };
  let activeLegendKey = null;


    const raw = [
  {"id":"GPT-3.5 Turbo","parent":"OpenAI","value":8.273,"date":"2022-11-30T00:00:00.000","ic":0},
  {"id":"PALM-2","parent":"Google","value":6.574,"date":"2023-05-10T00:00:00.000","ic":0},
  {"id":"GPT-4","parent":"OpenAI","value":21.472,"date":"2023-03-14T00:00:00.000","ic":0},
  {"id":"Gemini 1.0 Ultra","parent":"Google","value":12.841,"date":"2023-12-06T00:00:00.000","ic":0},
  {"id":"GPT-4 Turbo","parent":"OpenAI","value":24.213,"date":"2023-11-06T00:00:00.000","ic":0},
  {"id":"Gemini 1.5 Flash","parent":"Google","value":13.993,"date":"2024-05-14T00:00:00.000","ic":0},
  {"id":"Gemini 1.5 Pro (May '24)","parent":"Google","value":19.158,"date":"2024-05-15T00:00:00.000","ic":0},
  {"id":"GPT-4o (May '24)","parent":"OpenAI","value":26.309,"date":"2024-05-13T00:00:00.000","ic":0},
  {"id":"GPT-4o (Aug '24)","parent":"OpenAI","value":29.000,"date":"2024-08-06T00:00:00.000","ic":0},
  {"id":"Gemini 1.5 Pro (Sep '24)","parent":"Google","value":30.013,"date":"2024-09-24T00:00:00.000","ic":0},
  {"id":"o1-preview","parent":"OpenAI","value":44.922,"date":"2024-09-12T00:00:00.000","ic":0},
  {"id":"Gemini 2.0 Flash (experimental)","parent":"Google","value":31.812,"date":"2024-12-11T00:00:00.000","ic":0},
  {"id":"o1","parent":"OpenAI","value":47.186,"date":"2024-12-05T00:00:00.000","ic":0},
  {"id":"o3-mini (high)","parent":"OpenAI","value":50.782,"date":"2025-01-31T00:00:00.000","ic":0},
  {"id":"Gemini 2.0 Flash Thinking Experimental (Jan '25)","parent":"Google","value":37.691,"date":"2025-01-21T00:00:00.000","ic":0},
  {"id":"Gemini 2.5 Pro Preview (Mar '25)","parent":"Google","value":54.119,"date":"2025-03-25T00:00:00.000","ic":0},
  {"id":"o3","parent":"OpenAI","value":65.450,"date":"2025-04-16T00:00:00.000","ic":0},
  {"id":"Gemini 2.5 Pro","parent":"Google","value":59.590,"date":"2025-06-05T00:00:00.000","ic":0},
  {"id":"GPT-5 (high)","parent":"OpenAI","value":68.470,"date":"2025-08-07T00:00:00.000","ic":0},
  {"id":"GPT-5 Codex (high)","parent":"OpenAI","value":68.480,"date":"2025-09-23T00:00:00.000","ic":0},
  {"id":"Gemini 3 Pro Preview","parent":"Google","value":72.850,"date":"2025-11-18T00:00:00.000","ic":0},
  {"id":"GPT-5.1 (high)","parent":"OpenAI","value":69.710,"date":"2025-11-13T00:00:00.000","ic":0}
]
  const allowedIds = new Set([
  "GPT-3.5 Turbo",
  "PALM-2",
  "GPT-4",
  "Gemini 1.0 Ultra",
  "GPT-4 Turbo",
  "Gemini 1.5 Flash",
  "Gemini 1.5 Pro (May '24)",
  "GPT-4o (May '24)",
  "GPT-4o (Aug '24)",
  "Gemini 1.5 Pro (Sep '24)",
  "o1-preview",
  "Gemini 2.0 Flash (experimental)",
  "o1",
  "o3-mini (high)",
  "Gemini 2.0 Flash Thinking Experimental (Jan '25)",
  "Gemini 2.5 Pro Preview (Mar '25)",
  "o3",
  "Gemini 2.5 Pro",
  "GPT-5 (high)",
  "GPT-5 Codex (high)",
  "Gemini 3 Pro Preview",
  "GPT-5.1 (high)"
]);

  function parseDate(s){
    if(!s) return null;
    const str = String(s).trim();
    if(/^\d{4}-\d{2}$/.test(str)) return new Date(str + "-01");
    return new Date(str);
  }

  const data = raw.map(r=>({
    ...r,
    date: parseDate(r.date),
    value: +r.value,
    type: r.type.toLowerCase()
  })).filter(d=>d.date && !isNaN(d.date));

// const margin = {top:40, right:40, bottom:60, left:60};
// const container = document.getElementById('chart');
// const width = container.clientWidth - margin.left - margin.right;
// const height = container.clientHeight - margin.top - margin.bottom;

const container = document.getElementById('chart');
const margin = { top:40, right:40, bottom:60, left:60 };
// const TYPE_COLOR_MAP = { open:"#1565C0", closed:"#2E7D32" };
const logoSizeBase = 28;

function render(){
  const { width:W, height:H } = container.getBoundingClientRect();
  const width  = Math.max(320, W)  - margin.left - margin.right;
  const height = Math.max(220, H)  - margin.top  - margin.bottom;

  d3.select('#chart').selectAll('svg').remove();

  const svg = d3.select('#chart')
    .append('svg')
    .attr('width', width + margin.left + margin.right)
    .attr('height', height + margin.top + margin.bottom);

  svg.append('clipPath').attr('id','plot-clip')
    .append('rect')
    .attr('x', margin.left).attr('y', margin.top)
    .attr('width', width).attr('height', height);

  const g = svg.append('g')
  .attr('transform', `translate(${margin.left},${margin.top})`);

  svg.append('clipPath').attr('id','plot-clip')
    .append('rect')
    .attr('x', margin.left)
    .attr('y', margin.top)
    .attr('width', width)
    .attr('height', height);
  
  

  const plot = g.append('g').attr('clip-path', 'url(#plot-clip)');

  const minDate = d3.min(data, d => d.date);
  const lastDate = d3.max(data, d => d.date);

  // end of the year of the last data point (2025-12-31 here)
  const endOfYear = new Date(lastDate.getFullYear(), 11, 31);

  const x = d3.scaleTime()
    .domain([minDate, endOfYear])
    .range([0, width]);

  // const x = d3.scaleTime()
  //   .domain(d3.extent(data, d => d.date))
  //   .range([0, width]);

  const yMax = d3.max(data, d => d.value);
  const yMin = d3.min(data, d => d.value);
  const yPad = (yMax - yMin) * 0.08;

  const y = d3.scaleLinear()
    .domain([yMin - yPad, yMax + yPad])
    .range([height, 0]);

  g.append('g').attr('class','grid')
    .call(d3.axisLeft(y).tickSize(-width).tickFormat(''));
  g.append('g').attr('class','axis')
    .attr('transform', `translate(0,${height})`)
    .call(d3.axisBottom(x).tickFormat(d3.timeFormat('%b'))); //.tickFormat(d3.timeFormat('%Y-%m-%d')));
    
  g.append('g').attr('class','axis').call(d3.axisLeft(y));

  g.append('text').attr('class','axis-title')
    .attr('x', width/2).attr('y', height+45).attr('text-anchor','middle')
    .text('2025');
  g.append('text').attr('class','axis-title')
    .attr('transform','rotate(-90)')
    .attr('x', -height/2).attr('y', -45).attr('text-anchor','middle')
    .text('Last exam score');

  const linesGroup = g.append('g').attr('class','connection-lines');
  // function drawConnections(models, color){
  //   for (let i=0;i<models.length-1;i++){
  //     linesGroup.append('line')
  //       .attr('class','connection-line')
  //       .attr('x1', x(models[i].date))
  //       .attr('y1', y(models[i].value))
  //       .attr('x2', x(models[i+1].date))
  //       .attr('y2', y(models[i+1].value))
  //       .attr('stroke', color).attr('stroke-width', 2).attr('opacity', 0.6);
  //   }
  // }
  function drawConnections(models, color) {
  for (let i = 0; i < models.length - 1; i++) {
    const a = models[i];
    const b = models[i + 1];

    const x1 = x(a.date);
    const x2 = x(b.date);
    const y1 = y(a.value);
    const y2 = y(b.value);

    // 1) horizontal segment (stay at old value until new x)
    linesGroup.append('line')
      .attr('class', 'connection-line')
      .attr('x1', x1)
      .attr('y1', y1)
      .attr('x2', x2)
      .attr('y2', y1)
      .attr('stroke', color)
      .attr('stroke-width', 2)
      .attr('opacity', 0.6);

    // 2) vertical segment at the new x (jump to new value)
    linesGroup.append('line')
      .attr('class', 'connection-line')
      .attr('x1', x2)
      .attr('y1', y1)
      .attr('x2', x2)
      .attr('y2', y2)
      .attr('stroke', color)
      .attr('stroke-width', 2)
      .attr('opacity', 0.6);
  }
}
  const openModels = data.filter(d=>d.type==='open'   && allowedIds.has(d.id)).sort((a,b)=>a.date-b.date);
  const closedModels= data.filter(d=>d.type==='closed' && allowedIds.has(d.id)).sort((a,b)=>a.date-b.date);
  drawConnections(openModels, TYPE_COLOR_MAP.open);
  drawConnections(closedModels, TYPE_COLOR_MAP.closed);

  // function dashed(a,b){
  //   if(!a||!b) return;
  //   linesGroup.append('line')
  //     .attr('x1', x(a.date)).attr('y1', y(a.value))
  //     .attr('x2', x(b.date)).attr('y2', y(b.value))
  //     .attr('stroke','#666').attr('stroke-width',1.5)
  //     .attr('stroke-dasharray','5,5').attr('opacity',0.5);
  // }
  // const kimiThinking = data.find(d=>d.id==='kimi-k2-thinking');
  // const gpt5        = data.find(d=>d.id==='gpt-5-2025-08-07');
  // const kimiInstruct= data.find(d=>d.id==='kimi-k2-instruct');
  // dashed(kimiThinking, gpt5);
  // dashed(kimiThinking, kimiInstruct);

  const logoSize = Math.max(18, Math.min(logoSizeBase, Math.min(width,height)/20));

  plot.append('g').attr('class','grid')
    .call(d3.axisLeft(y).tickSize(-width).tickFormat(''));

  g.append('g').attr('class','axis')
    .attr('transform', `translate(0,${height})`)
       .call(d3.axisBottom(x).tickFormat(d3.timeFormat('%b'))); 

  g.append('g').attr('class','axis')
    .call(d3.axisLeft(y));

  // connection lines
  //const linesGroup = plot.append('g').attr('class','connection-lines');
  // dots (logos) and labels also use `plot`:

  
  const ringSpacing = Math.max(3, logoSize * 0.15);
  const ringStroke = Math.max(1, logoSize * 0.08);

  const dots = g.selectAll('.dot')
    .data(data)
    .join(enter => {
      const dot = enter.append('g').attr('class','dot');
      dot.append('circle').attr('class','dot-ring');
      dot.append('image').attr('class','dot-logo');
      return dot;
    });

  dots
    .attr('transform', d => `translate(${x(d.date)},${y(d.value)})`)
    .attr('opacity', 0.9);

  const syncLogoSize = (selection, size) => {
    selection
      .attr('width', size)
      .attr('height', size)
      .attr('x', -size/2)
      .attr('y', -size/2);
  };

  const setDotSize = (selection, size) => {
    syncLogoSize(selection.select('.dot-logo'), size);
    selection.select('.dot-ring')
      .attr('r', size/2 + ringSpacing)
      .attr('stroke-width', ringStroke);
  };

  dots.select('.dot-logo')
    .attr('href', d => LOGO_MAP[d.parent] || "logos/default.png");
  dots.select('.dot-ring')
    .attr('stroke', d => TYPE_COLOR_MAP[d.type] || '#7f7f7f');

  setDotSize(dots, logoSize);

  const tooltip = d3.select('#tooltip');

  const xPad = logoSize/2 + 6, topPad = 12, bottomPad = 6;
  const clampX = px => Math.max(xPad, Math.min(width - xPad, px));
  const clampY = py => Math.max(topPad, Math.min(height - bottomPad, py));
  const labelGap = logoSize/2 + ringSpacing + 10;
  const labelPos = d => {
    const baseX = x(d.date);
    const clampedX = clampX(baseX);
    let yAbove = y(d.value) - labelGap;
    let yFinal = (yAbove < topPad) ? (y(d.value) + labelGap) : yAbove;
    yFinal = clampY(yFinal);
    let anchor = 'middle';
    let xFinal = clampedX;
    if (clampedX <= xPad+1){
      anchor = 'start';
      xFinal = clampX(baseX + labelGap);
    } else if (clampedX >= width-xPad-1){
      anchor = 'end';
      xFinal = clampX(baseX - labelGap);
    }
    return { x: xFinal, y: yFinal, anchor };
  };

const markLayer = typeof plot !== "undefined" ? plot : g;
const labelFontSize = window.innerWidth <= 600 ? '6px' : '11px';
const strokeWidth = window.innerWidth <= 600 ? '1px' : '2px';

const labels = g.selectAll('.dot-label')
  .data(data)
  .enter()
  .append('text')
  .attr('class','dot-label')
  .attr('x', d => labelPos(d).x)
  .attr('y', d => labelPos(d).y)
  .attr('text-anchor', d => labelPos(d).anchor)
  .text(d => d.id)
  .style('font-weight','700')
  .style('font-size', labelFontSize)
  .style('paint-order','stroke')
  .style('stroke','white')
  .style('stroke-width', strokeWidth)
  .style('pointer-events','none');

  labels
    .filter(d => d.id === 'Gemini-2.0-Flash-Thinking-2025-01')
    .attr('text-anchor', 'start')
    .attr('dx', 60)
    .attr('y', d => clampY(labelPos(d).y +60));
  
  labels
  .filter(d => d.id === "gpt-oss-120b")
  .attr('text-anchor', 'start')
  .attr('dx', labelGap)
  .attr('y', d => clampY(labelPos(d).y +55));

  labels
    .filter(d => d.id === 'gemini-2.5-pro-experimental-2025-03')
    .attr('text-anchor','end')
    .attr('dx', -labelGap*0.99);

  function positionTooltip(e, d){
    const tt = tooltip.node();
    const w = tt.offsetWidth;
    const spaceRight = window.innerWidth - e.pageX;
    const left = (d.id === 'kimi-k2-thinking' || spaceRight < w + 20)
      ? (e.pageX - w - 10)
      : (e.pageX + 10);
    tooltip.style('left', `${left}px`).style('top', `${e.pageY - 10}px`);
  }
  dots.on('mouseenter', function (e, d) {
    const dot = d3.select(this);
    setDotSize(dot, logoSize*1.2);

    tooltip.style('opacity', 1).html(`
      <div class="tooltip-title">${d.id}</div>
      <table class="tooltip-table">
        <tr><td class="title">Parent:</td><td class="data">${d.parent}</td></tr>
        <tr><td class="title">Date:</td><td class="data">${d.date.toISOString().slice(0,10)}</td></tr>
 
        <tr><td class="title">Last exam score:</td><td class="data">${d.value}</td></tr>
      </table>
    `);

    positionTooltip(e, d);
  })
    .on('mousemove', function(e,d){ positionTooltip(e,d); })
    .on('mouseleave', function(){
      setDotSize(d3.select(this), logoSize);
      tooltip.style('opacity',0);
    });
}
render();
// new ResizeObserver(render).observe(document.getElementById('chart'));

// function initLegend(){
//   const legend = d3.select('#legend').html('');

//   const items = [
//     { label: 'Google',   color: TYPE_COLOR_MAP.open },
//     { label: 'OpenAI', color: TYPE_COLOR_MAP.closed },
//   ];
//   const row = legend.selectAll('.legend-item')
//     .data(items)
//     .enter()
//     .append('div')
//     .attr('class','legend-item');

//   row.append('span')
//     .attr('class','legend-square')
//     .style('background', d => d.color);

//   row.append('span')
//     .text(d => d.label);
// }
initLegend();
new ResizeObserver(render).observe(document.getElementById('chart'));

function updateOpacity(){
  if(activeLegendKey){
    dots.attr('opacity', d => d.type === activeLegendKey ? 0.75 : 0.15);
    g.selectAll('.dot-label').attr('opacity', d => d.type === activeLegendKey ? 1 : 0.2);
  } else {
    dots.attr('opacity', 0.75);
    g.selectAll('.dot-label').attr('opacity', 1);
  }
}

function updateLegend(){
  legend.selectAll('.legend-item')
    .classed('dim', function(){
      const text = d3.select(this).select('span:last-child').text().toLowerCase();
      return activeLegendKey && text !== activeLegendKey;
    });
}
</script>
</body>
</html>
