<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Continents by Year</title>
<script src="https://d3js.org/d3.v7.min.js"></script>
<style>
  html, body { height:100%; margin:0; background:#fff; font-family:system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Helvetica, Arial, sans-serif; overflow:hidden; }
  #chart { display:block; width:100%; height:calc(100vh - 40px); }
  .axis path, .axis line { stroke:#bbb; }
  .axis text { font-size:11px; fill:#444; }
  #tooltip { position:absolute; background:#fff; border:1px solid #ccc; padding:4px 8px; font-size:12px; pointer-events:none; opacity:0; transition:opacity .2s; border-radius:4px; box-shadow:0 2px 8px rgba(0,0,0,.06); }
  #tooltip:after { content:""; position:absolute; left:50%; transform:translateX(-50%); bottom:-6px; border-width:6px 6px 0 6px; border-style:solid; border-color:#ccc transparent transparent transparent; }
  #tooltip:before { content:""; position:absolute; left:50%; transform:translateX(-50%); bottom:-7px; border-width:7px 7px 0 7px; border-style:solid; border-color:#fff transparent transparent transparent; }
  #legend { display:flex; flex-wrap:wrap; gap:8px 12px; align-items:center; justify-content:center; margin:4px 0 6px; }
  .legend-item { display:inline-flex; align-items:center; gap:6px; color:#333; font-weight:600; font-size:11px; }
  .swatch { width:10px; height:10px; border:1px solid rgba(0,0,0,.35); border-radius:3px; }
</style>
</head>
<body>
<svg id="chart"></svg>
<div id="tooltip"></div>
<div id="legend" aria-label="Legend"></div>

<script>
const rawCSV = `area,2019,2020,2021,2022,2023,2024,2025\nAfrica,1,0,1,1,3,2,2\nAsia,82,83,116,120,75,64,45\nEurope,141,139,171,181,151,141,95\nNorth America,335,359,440,415,334,292,231\nOceania,12,19,21,10,11,3,11\nSouth America,8,10,4,8,6,2,1`;

const table = d3.csvParse(rawCSV, d3.autoType);
const years = Object.keys(table[0]).filter(k => k !== 'area');
const continents = table.map(d => d.area);
const data = [];
for (const row of table) for (const y of years) data.push({ year: y, area: row.area, value: row[y] });

const color = d3.scaleOrdinal().domain(continents).range(d3.schemeTableau10.slice(0, continents.length));
const svg = d3.select('#chart');
const tooltip = d3.select('#tooltip');

function render() {
  const rect = svg.node().getBoundingClientRect();
  const W = rect.width;
  const H = rect.height;
  const margin = { top: 10, right: 20, bottom: 50, left: 50 };
  const width = W - margin.left - margin.right;
  const height = H - margin.top - margin.bottom;

  svg.attr('viewBox', `0 0 ${W} ${H}`);
  svg.selectAll('*').remove();
  const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`);

  const x0 = d3.scaleBand().domain(years).range([0, width]).paddingInner(0.15);
  const x1 = d3.scaleBand().domain(continents).range([0, x0.bandwidth()]).padding(0.05);
  const y = d3.scaleLinear().domain([0, d3.max(data, d => d.value)]).nice().range([height, 0]);

  g.append('g').attr('transform', `translate(0,${height})`).attr('class', 'axis').call(d3.axisBottom(x0));
  g.append('g').attr('class', 'axis').call(d3.axisLeft(y).ticks(5).tickFormat(d3.format(',')));

  const groups = g.selectAll('.year-group')
    .data(years)
    .join('g')
    .attr('transform', d => `translate(${x0(d)},0)`);

  groups.selectAll('rect')
    .data(y => continents.map(a => ({ year: y, area: a, value: table.find(r => r.area === a)[y] })))
    .join('rect')
    .attr('x', d => x1(d.area))
    .attr('y', height)
    .attr('width', x1.bandwidth())
    .attr('height', 0)
    .attr('fill', d => color(d.area))
    .attr('rx', 2)
    .on('mouseenter', (event, d) => {
      tooltip.style('opacity', 1).html(`<strong>${d.area}</strong><br>Year ${d.year}: ${d.value}`);
      moveTooltip(event);
    })
    .on('mousemove', moveTooltip)
    .on('mouseleave', () => tooltip.style('opacity', 0))
    .transition().duration(600)
    .attr('y', d => y(d.value))
    .attr('height', d => height - y(d.value));

  function moveTooltip(event) {
    tooltip.style('left', (event.pageX + 10) + 'px').style('top', (event.pageY - 20) + 'px');
  }

  const legend = d3.select('#legend');
  legend.selectAll('*').remove();
  legend.selectAll('.legend-item')
    .data(continents)
    .join('div')
    .attr('class', 'legend-item')
    .html(d => `<span class='swatch' style='background:${color(d)}'></span>${d}`);
}

render();
window.addEventListener('resize', () => { clearTimeout(window._rT); window._rT = setTimeout(render, 200); });
</script>
</body>
</html>