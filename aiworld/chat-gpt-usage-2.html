<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Chat GPT Usage</title>
<script src="https://d3js.org/d3.v7.min.js"></script>
<style>
html, body { height: 100%; }
body { margin: 0; overflow: hidden; background: #ffffff; color: #111; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Helvetica, Arial, sans-serif; height: 100vh; }

.viz-grid { display: grid; grid-template-rows: 17fr 2fr 1fr; grid-template-columns: 1fr 1fr; height: 100vh; width: 100vw; box-sizing: border-box; padding-bottom: clamp(8px, 2vh, 18px); }
#container1 { grid-row: 1; grid-column: 1 / span 2; display: flex; overflow: hidden; min-height: 0; column-gap: 0; }
#container1 .y-axis-container { flex: 0 0 clamp(26px, 3vw, 40px); display: flex; align-items: center; justify-content: center; min-width: 0; border-right: 1px solid rgba(0,0,0,0.1); box-sizing: border-box; padding: 0 4px; }
#container1 .y-axis-label { writing-mode: vertical-rl; transform: rotate(180deg); text-align: center; font-weight: 600; font-size: clamp(11px, 1.2vw, 16px); color: #333; }
#container1 .chart-wrapper { flex: 1 1 auto; display: flex; min-width: 0; height: 100%; margin-left: -6px; }
#container1 .chart-wrapper-inner { flex: 1 1 auto; display: flex; min-width: 0; height: 100%; }
#container2 { grid-row: 2; grid-column: 1 / span 2; display: flex; align-items: center; justify-content: center; overflow: hidden; }
#container3 { grid-row: 3; grid-column: 1; display: flex; align-items: center; justify-content: flex-start; padding: 0 20px; overflow: hidden; min-width: 0; }
#container4 { grid-row: 3; grid-column: 2; display: flex; align-items: center; justify-content: flex-end; padding: 0 20px; overflow: hidden; min-width: 0; }
#container4 a { height: 100%; display: flex; align-items: center; }

#viz { position: relative; width: 100%; height: 100%; min-width: 0; min-height: 0; }
#chart { display: block; width: 100%; height: 100%; }
#tooltip { position: absolute; background: #fff; border: 1px solid #d9d9df; border-radius: 6px; padding: 6px 8px; font-size: 12px; pointer-events: none; opacity: 0; box-shadow: 0 4px 14px rgba(0,0,0,0.08); transition: opacity .12s ease; }

#container2 { font-size: clamp(10px, 1.6vw, 16px); }
.custom-legend { display: flex; flex-wrap: wrap; align-items: center; justify-content: center; gap: clamp(6px, 1.5vw, 14px); background: rgba(255, 255, 255, 0.9); padding: clamp(6px, 1.2vh, 10px) clamp(10px, 2vw, 16px); border-radius: clamp(6px, 1.2vw, 12px); box-shadow: 0 2px 8px rgba(0,0,0,0.1); overflow: auto; max-width: 100%; max-height: 100%; font-size: 1em; }
.legend-item { display: flex; align-items: center; gap: 6px; cursor: pointer; transition: opacity .2s ease; font-weight: 600; color: #333; font-size: 1em; }
.legend-item.dim { opacity: 0.35; }
.legend-item:focus-visible { outline: 2px solid rgba(0,0,0,0.5); outline-offset: 2px; }
.legend-square { width: clamp(10px, 1.2vw, 14px); height: clamp(10px, 1.2vw, 14px); border-radius: 4px; box-shadow: 0 0 0 1px rgba(0,0,0,0.15) inset; }

.source-text { font-size: clamp(10px, 1.6vw, 16px); font-weight: 600; color: #333; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100%; font-style: normal; }
.source-text a { color: #2756d3; text-decoration: underline; cursor: pointer; font-style: normal; }
.source-text a:visited { color: #2756d3; }
.logo { height: 100%; width: auto; max-height: 100%; max-width: 100%; pointer-events: auto; object-fit: contain; }

@media (max-height: 500px) {
  .viz-grid { grid-template-rows: 1fr; grid-template-columns: 1fr; padding-bottom: 0; }
  #container1 { grid-row: 1; grid-column: 1; }
  #container2, #container3, #container4 { display: none !important; }
}

.axis path, .axis line { stroke: #cfd2d7; }
.bar-seg { transition: filter .2s ease, opacity .2s ease; }
.tick text { font-size: clamp(8px, 0.9vw, 11px); }
</style>
</head>
<body>
<div class="viz-grid">
  <div id="container1" class="container chart-container">
    <div class="y-axis-container">
      <div class="y-axis-label">Team / function</div>
    </div>
    <div class="chart-wrapper">
      <div class="chart-wrapper-inner">
        <div id="viz">
          <svg id="chart"></svg>
          <div id="tooltip"></div>
        </div>
      </div>
    </div>
  </div>
  <div id="container2" class="container legend-container">
    <div class="custom-legend" id="legend"></div>
  </div>
  <div id="container3" class="container source-container">
    <div class="source-text">Source: <a href="https://cdn.openai.com/pdf/3c7f7e1b-36c4-446b-916c-11183e4266b7/chatgpt-usage-and-adoption-patterns-at-work.pdf" target="_blank" rel="noopener">OpenAI Usage Report</a></div>
  </div>
  <div id="container4" class="container logo-container">
    <a href="https://aiworld.eu/" target="_blank" rel="noopener">
      <img src="https://aiworld.eu/logo-transparent.svg" class="logo" alt="AI World logo">
    </a>
  </div>
</div>
<script>
const data=[
  {category:"Engineering",Writing:14,FactualHowTo:22,Programming:42,MediaGeneration:5,Teaching:7,DataAnalysis:2,Ideation:2,Others:6},
  {category:"Analytics",Writing:24,FactualHowTo:23,Programming:25,MediaGeneration:6,Teaching:5,DataAnalysis:6,Ideation:2,Others:9},
  {category:"IT",Writing:19,FactualHowTo:28,Programming:30,MediaGeneration:6,Teaching:5,DataAnalysis:3,Ideation:2,Others:7},
  {category:"Research",Writing:20,FactualHowTo:24,Programming:28,MediaGeneration:5,Teaching:8,DataAnalysis:4,Ideation:3,Others:8},
  {category:"Product",Writing:33,FactualHowTo:25,Programming:11,MediaGeneration:8,Teaching:4,DataAnalysis:5,Ideation:4,Others:10},
  {category:"Sales",Writing:40,FactualHowTo:26,Programming:3,MediaGeneration:7,Teaching:4,DataAnalysis:4,Ideation:3,Others:13},
  {category:"Partnerships",Writing:47,FactualHowTo:24,Programming:2,MediaGeneration:6,Teaching:3,DataAnalysis:4,Ideation:3,Others:11},
  {category:"Customer experience",Writing:47,FactualHowTo:22,Programming:5,MediaGeneration:6,Teaching:4,DataAnalysis:4,Ideation:3,Others:9},
  {category:"Marketing",Writing:41,FactualHowTo:21,Programming:4,MediaGeneration:9,Teaching:3,DataAnalysis:4,Ideation:8,Others:10},
  {category:"Comms",Writing:50,FactualHowTo:19,Programming:2,MediaGeneration:6,Teaching:3,DataAnalysis:2,Ideation:6,Others:12},
  {category:"Design",Writing:27,FactualHowTo:19,Programming:13,MediaGeneration:20,Teaching:3,DataAnalysis:2,Ideation:7,Others:9},
  {category:"Operations",Writing:39,FactualHowTo:25,Programming:7,MediaGeneration:7,Teaching:4,DataAnalysis:5,Ideation:3,Others:10},
  {category:"Finance",Writing:30,FactualHowTo:32,Programming:7,MediaGeneration:6,Teaching:6,DataAnalysis:6,Ideation:2,Others:11},
  {category:"Legal",Writing:41,FactualHowTo:30,Programming:1,MediaGeneration:6,Teaching:6,DataAnalysis:2,Ideation:2,Others:12},
  {category:"Human resources",Writing:46,FactualHowTo:22,Programming:4,MediaGeneration:7,Teaching:3,DataAnalysis:4,Ideation:4,Others:10},
  {category:"Project management",Writing:35,FactualHowTo:26,Programming:10,MediaGeneration:8,Teaching:4,DataAnalysis:5,Ideation:3,Others:9},
  {category:"Administrative",Writing:50,FactualHowTo:24,Programming:2,MediaGeneration:5,Teaching:4,DataAnalysis:3,Ideation:3,Others:9}
];
const keys=["Writing","FactualHowTo","Programming","MediaGeneration","Teaching","DataAnalysis","Ideation","Others"];
const labels={
  Writing:"Writing",
  FactualHowTo:"Factual & How To",
  Programming:"Programming",
  MediaGeneration:"Media generation",
  Teaching:"Teaching",
  DataAnalysis:"Data analysis",
  Ideation:"Ideation",
  Others:"Others"
};
const colors={
  Writing:"#264653",
  FactualHowTo:"#2a9d8f",
  Programming:"#e9c46a",
  MediaGeneration:"#f4a261",
  Teaching:"#e76f51",
  DataAnalysis:"#8ab17d",
  Ideation:"#a760a3",
  Others:"#7f7f7f"
};
const svg=d3.select("#chart");
const tooltip=d3.select("#tooltip");

let activeKey=null;
function updateHighlight(){
  const bars=d3.selectAll('.bar-seg');
  bars.transition().duration(150).style('opacity', d=> activeKey && d.key!==activeKey ? 0.25 : 1);
  const lbls=d3.selectAll('g.segment-labels text');
  lbls.transition().duration(150).style('opacity', d=> activeKey && d.key!==activeKey ? 0.25 : 1);
}
function updateLegendStyles(){
  d3.select('#legend').selectAll('.legend-item')
    .classed('dim', d=> activeKey && d!==activeKey)
    .attr('aria-pressed', d=> activeKey===d ? 'true' : 'false');
}

function wrapTicks(selection, width, lineHeight=1.2, maxLines=3, xPos=0){
  selection.each(function(){
    const text=d3.select(this);
    const words=text.text().split(/\s+/);
    const y=text.attr("y");
    const baseDy=parseFloat(text.attr("dy"))||0;
    text.text(null);
    let line=[]; let lineNumber=0;
    let tspan=text.append("tspan").attr("x",xPos).attr("y",y).attr("dy",baseDy+"em");
    for(let i=0;i<words.length;i++){
      line.push(words[i]);
      tspan.text(line.join(" "));
      if(tspan.node().getComputedTextLength()>width){
        line.pop();
        tspan.text(line.join(" "));
        line=[words[i]];
        lineNumber++;
        if(lineNumber>=maxLines){
          let prev=tspan;
          let txt=prev.text();
          while(prev.node().getComputedTextLength()>width && txt.length>0){ txt=txt.slice(0,-1); prev.text(txt); }
          prev.text(txt.replace(/\s+$/,'')+"â€¦");
          return;
        }
        tspan=text.append("tspan").attr("x",xPos).attr("y",y).attr("dy",(baseDy+lineNumber*lineHeight)+"em").text(words[i]);
      }
    }
  });
}

function render(){
  const viz=document.getElementById("viz");
  const rect=viz.getBoundingClientRect();
  const fullW=rect.width;
  const fullH=rect.height;
  const tickFont=Math.max(8, Math.min(13, fullW/110));
  const axisContainer=document.querySelector('#container1 .y-axis-container');
  const axisContainerWidth=axisContainer?axisContainer.getBoundingClientRect().width:36;
  const measureCtx=render._measureCtx || (render._measureCtx=document.createElement('canvas').getContext('2d'));
  const fontFamily=window.getComputedStyle(document.body).fontFamily || 'system-ui, -apple-system, "Segoe UI", sans-serif';
  measureCtx.font=`${tickFont}px ${fontFamily}`;
  const maxLabelWidth=d3.max(data, d=>measureCtx.measureText(d.category).width) || 0;
  const labelGap=Math.max(14, Math.min(26, Math.round(fullW*0.03)));
  const axisOffset = labelGap - 2;
  const spacing = 4;
  const minMarginLeft = axisContainerWidth + spacing;
  const computedMarginLeft = Math.ceil(maxLabelWidth + axisContainerWidth + spacing - axisOffset);
  const margin={
    top:12,
    right:48,
    bottom:24,
    left:Math.max(minMarginLeft, computedMarginLeft)
  };
  svg.attr("width",fullW).attr("height",fullH);
  const width=fullW-margin.left-margin.right;
  const height=fullH-margin.top-margin.bottom;

  const defs=svg.selectAll('defs').data([null]).join('defs');
  defs.select('#rowWhiteFade').remove();
  defs.select('#rowGrayFade').remove();
  const gW=defs.append('linearGradient').attr('id','rowWhiteFade').attr('gradientUnits','userSpaceOnUse').attr('x1',0).attr('x2',fullW).attr('y1',0).attr('y2',0);
  gW.append('stop').attr('offset','0%').attr('stop-color','#ffffff').attr('stop-opacity',0);
  gW.append('stop').attr('offset','6%').attr('stop-color','#ffffff').attr('stop-opacity',1);
  gW.append('stop').attr('offset','100%').attr('stop-color','#ffffff').attr('stop-opacity',1);
  const gG=defs.append('linearGradient').attr('id','rowGrayFade').attr('gradientUnits','userSpaceOnUse').attr('x1',0).attr('x2',fullW).attr('y1',0).attr('y2',0);
  gG.append('stop').attr('offset','0%').attr('stop-color','#f0efe9').attr('stop-opacity',0);
  gG.append('stop').attr('offset','6%').attr('stop-color','#f0efe9').attr('stop-opacity',1);
  gG.append('stop').attr('offset','100%').attr('stop-color','#f0efe9').attr('stop-opacity',1);

  const gRoot=svg.selectAll("g.root").data([null]).join("g").attr("class","root").attr("transform",`translate(${margin.left},${margin.top})`);
  const x=d3.scaleLinear().domain([0,100]).range([labelGap,width]);
  const y=d3.scaleBand().domain(data.map(d=>d.category)).range([0,height]).paddingInner(0.28);
  const stack=d3.stack().keys(keys).value((d,k)=>d[k]);
  const series=stack(data);
  const rowBG=gRoot.selectAll("rect.row").data(data.map(d=>d.category));
  const step=y.step();
  const pad=(step-y.bandwidth())/2;
  rowBG.join(
    enter=>enter.append("rect").attr("class","row").attr("x",0).attr("y",d=>y(d)-pad).attr("width",fullW).attr("height",step).attr("fill",(d,i)=>i%2?"url(#rowGrayFade)":"url(#rowWhiteFade)"),
    update=>update.attr("x",0).attr("y",d=>y(d)-pad).attr("width",fullW).attr("height",step)
  );
  const layers=gRoot.selectAll("g.layer").data(series,d=>d.key).join(enter=>enter.append("g").attr("class","layer").attr("fill",d=>colors[d.key]));
  const barH=Math.max(2,y.bandwidth()*0.6);
  layers.selectAll("rect").data(d=>d.map(v=>({key:d.key,cat:v.data.category,v:v}))).join("rect").attr("class","bar-seg")
    .attr("x",d=>x(d.v[0]))
    .attr("y",d=>y(d.cat)+(y.bandwidth()-barH)/2)
    .attr("width",d=>Math.max(0.5,x(d.v[1])-x(d.v[0])))
    .attr("height",barH)
    .on("mouseenter",(event,d)=>{ d3.select(event.currentTarget).style("filter",`drop-shadow(0 0 8px ${colors[d.key]})`); })
    .on("mousemove",(event,d)=>{const val=(d.v[1]-d.v[0]).toFixed(1);tooltip.style("opacity",1).style("left",event.pageX+10+"px").style("top",event.pageY-12+"px").html(`${labels[d.key]}: ${val}%`);})
    .on("mouseleave",function(){ tooltip.style("opacity",0); d3.select(this).style("filter",null); });
  const segData=series.flatMap(s=>s.map(v=>({key:s.key,cat:v.data.category,v:v})));
  const labelsG=gRoot.selectAll("g.segment-labels").data([null]).join("g").attr("class","segment-labels");
  const labelFont=Math.max(7, Math.min(11, fullW/140));
  const labelsSel=labelsG.selectAll("text").data(segData, d=>d.key+"::"+d.cat);
  labelsSel.join(
    enter=>enter.append("text")
      .attr("text-anchor","middle")
      .attr("dy","0.35em")
      .style("fill","#ffffff")
      .style("font-weight","600")
      .style("pointer-events","none"),
    update=>update
  )
  .style("font-size",labelFont+"px")
  .attr("x",d=>x(d.v[0])+(x(d.v[1])-x(d.v[0]))/2)
  .attr("y",d=>y(d.cat)+y.bandwidth()/2)
  .text(function(d){
    var raw = d.v[1]-d.v[0];
    var str = raw.toFixed(1);
    if(str.endsWith('.0')){
      str = str.slice(0, -2);
    }
    return str + "%";
  })
  .each(function(d){
    const segPx=x(d.v[1])-x(d.v[0]);
    const pad=4;
    const minH=labelFont*0.9;
    const textWidth=this.getComputedTextLength();
    const enoughWidth=(segPx >= textWidth + pad*2);
    const enoughHeight=(barH >= minH);
    d3.select(this).attr("visibility", (enoughWidth && enoughHeight) ? "visible" : "hidden");
  });
  const xAxis=gRoot.selectAll("g.x").data([null]).join("g").attr("class","axis x").attr("transform",`translate(0,${y.range()[1]})`);
  const tickCount=Math.max(4, Math.round(width/100));
  xAxis.call(d3.axisBottom(x).ticks(tickCount).tickFormat(d=>Number(d).toFixed(1)+"%"));
  const yAxis=gRoot.selectAll("g.y").data([null]).join("g").attr("class","axis y");
  const padTicks=Math.max(4, Math.min(12, labelGap*0.35));
  yAxis.attr("transform", `translate(${axisOffset},0)`)
    .call(d3.axisLeft(y).tickSize(0).tickPadding(padTicks));
  yAxis.selectAll("path").remove();
  const wrapWidth=Math.max(maxLabelWidth + 6, margin.left - axisOffset - 8);
  const maxLines=Math.max(1, Math.min(3, Math.floor((y.bandwidth()*0.95)/(tickFont*1.25))));
  const tickX = -2;
  yAxis.selectAll("text")
    .style("font-size", tickFont+"px")
    .call(wrapTicks, wrapWidth, 1.12, maxLines, tickX)
    .style("text-anchor","end")
    .attr("x", tickX)
    .attr("dx", 0);
  yAxis.selectAll("text tspan").attr("x", tickX);
  yAxis.selectAll("g.tick").each(function(d){
    const g=d3.select(this);
    const t=g.select("text");
    const bb=t.node().getBBox();
    const desired=y(d)+y.bandwidth()/2;
    const current=bb.y+bb.height/2;
    const dy=desired-current;
    g.attr("transform",`translate(0,${dy})`);
  });
  updateHighlight();
}
function buildLegend(){
  const el=d3.select("#legend");
  el.selectAll("*").remove();
  const items=el.selectAll("div.legend-item").data(keys).enter()
    .append("div")
    .attr("class","legend-item")
    .attr("role","button")
    .attr("tabindex",0)
    .attr("aria-pressed","false");

  items.append("div").attr("class","legend-square").style("background", d=>colors[d]);
  items.append("span").text(d=>labels[d]);

  function toggleKey(event, d){
    activeKey = (activeKey === d ? null : d);
    updateLegendStyles();
    updateHighlight();
  }

  items.on('click', toggleKey)
    .on('keydown', function(event, d){
      if(event.key === 'Enter' || event.key === ' '){
        event.preventDefault();
        toggleKey(event, d);
      }
    });

  updateLegendStyles();
}
render();
buildLegend();

window.addEventListener("resize", function(){ render(); });

var vizEl = document.getElementById('viz');
if (typeof ResizeObserver !== 'undefined' && vizEl) {
  var chartObserver = new ResizeObserver(function(){ render(); });
  chartObserver.observe(vizEl);
}
</script>
</body>
</html>
