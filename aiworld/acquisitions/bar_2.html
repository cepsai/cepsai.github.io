<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>no idea</title>
<script src="https://d3js.org/d3.v7.min.js"></script>
<style>
html,body{height:100%;overflow:hidden;}
body{font-family:sans-serif; margin:0; padding:0;}
.axis path,.axis line{stroke:#bbb;}
.tick text{font-size: 12px;}
#tooltip{position:absolute;background:#fff; border:1px solid #ccc; padding:4px 8px;font-size:12px; pointer-events:none; opacity:0; transition:opacity 0.2s;}
#chart{display:block;margin:0 auto; width: 100%; height: auto;}
#tooltip:after{content:"";position:absolute;left:50%;transform:translateX(-50%);bottom:-6px;border-width:6px 6px 0 6px;border-style:solid;border-color:#ccc transparent transparent transparent;}
#tooltip:before{content:"";position:absolute;left:50%;transform:translateX(-50%);bottom:-7px;border-width:7px 7px 0 7px;border-style:solid;border-color:#fff transparent transparent transparent;}
.axis text { white-space: nowrap; }
.logo {
  position: absolute;
  bottom: clamp(6px, 4vh, 20px);
  right: 20px;
  width: clamp(80px, 10vw, 200px);
  pointer-events: auto;
  z-index: 1000;
  opacity: 1;
  transition: opacity 0.3s ease;
}
.logo.overlapped { opacity: 0.15; }
.logo.overlapped:hover { opacity: 1; }
.source-text {
  position: absolute;
  bottom: clamp(10px, 4vh, 30px);
  left: 20px;
  pointer-events: auto;
  font-size: clamp(12px, 1.5vw, 20px);
  font-weight: bold;
  color: #555555;
  z-index: 1000;
  opacity: 1;
  font-style: italic;
  transition: opacity 0.3s ease;
}
.source-text.overlapped { opacity: 0.15; }
.source-text.overlapped:hover { opacity: 1; }
.source-text a{color:#1a73e8; text-decoration:underline; cursor:pointer;}
.source-text a:visited{color:#1a73e8;}
button:focus{outline:none;}
button:hover{filter:brightness(0.97);}
#controls{display:flex;gap:10px;--gap:10px;--btn-count:5;--btn-fs:12px;--btn-pad-y:8px;--btn-pad-x:12px;margin:0 0 8px 0;align-items:center;justify-content:center;flex-wrap:none;}
#controls .btn{appearance:none;border:1px solid #d0d0d7;background:linear-gradient(#ffffff,#f6f7fb);border-radius:10px;padding:var(--btn-pad-y) var(--btn-pad-x);cursor:pointer;font-weight:600;min-height:30px;line-height:1;transition:transform .06s ease, box-shadow .2s ease, background .2s ease, color .2s ease, border-color .2s ease;box-shadow:0 1px 2px rgba(0,0,0,.04), inset 0 -1px 0 rgba(0,0,0,.03);flex:1 1 calc((100% - var(--gap) * (var(--btn-count) - 1))/var(--btn-count));min-width:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-size:var(--btn-fs);} 
#controls .btn:hover{transform:translateY(-1px);box-shadow:0 3px 8px rgba(0,0,0,.08), inset 0 -1px 0 rgba(0,0,0,.02);} 
#controls .btn:active{transform:translateY(0);} 
#controls .btn:focus-visible{outline:2px solid #1a73e8;outline-offset:2px;} 
#controls .btn.active{background:#1a73e8;color:#fff;border-color:#1a73e8;box-shadow:0 4px 10px rgba(26,115,232,.35);} 
#legend{display:flex;flex-wrap:wrap;gap:12px;row-gap:10px;align-items:center;justify-content:center;padding:10px 12px 6px 12px;margin:0 auto;max-width:100%;overflow-y:auto;max-height:150px;}
#legend .legend-item{display:inline-flex;align-items:center;gap:8px;white-space:nowrap;font-weight:600;font-size:clamp(12px,1.4vw,16px);color:#333;}
#legend .swatch{width:clamp(10px,1.2vw,16px);height:clamp(10px,1.2vw,16px);border:1px solid rgba(0,0,0,.4);border-radius:3px;box-sizing:border-box;}
</style>
</head>
<body>
<svg id="chart"></svg>
<div id="tooltip"></div>
<div id="legend" aria-label="Chart legend"></div>

<script>

const DATA = [
  {
    "id": "Africa",
    "series": "Acquiree",
    "y": 100000000,
    "label": "$100.00M"
  },
  {
    "id": "Africa",
    "series": "Acquirer",
    "y": 100000000,
    "label": "$100.00M"
  },
  {
    "id": "Asia",
    "series": "Acquiree",
    "y": 9472596099,
    "label": "$9.47B"
  },
  {
    "id": "Asia",
    "series": "Acquirer",
    "y": 11412137641,
    "label": "$11.41B"
  },
  {
    "id": "Europe",
    "series": "Acquiree",
    "y": 22084377494,
    "label": "$22.08B"
  },
  {
    "id": "Europe",
    "series": "Acquirer",
    "y": 8363698658,
    "label": "$8.36B"
  },
  {
    "id": "North America",
    "series": "Acquiree",
    "y": 138791984367,
    "label": "$138.79B"
  },
  {
    "id": "North America",
    "series": "Acquirer",
    "y": 151043219944,
    "label": "$151.04B"
  },
  {
    "id": "Oceania",
    "series": "Acquiree",
    "y": 1771162481,
    "label": "$1.77B"
  },
  {
    "id": "Oceania",
    "series": "Acquirer",
    "y": 1852944647,
    "label": "$1.85B"
  },
  {
    "id": "South America",
    "series": "Acquiree",
    "y": 254982114,
    "label": "$254.98M"
  },
  {
    "id": "South America",
    "series": "Acquirer",
    "y": 254982114,
    "label": "$254.98M"
  }
];

// Colores por serie (ajústalos si quieres)
const SERIES_COLORS = {
  "Acquiree": "#1846C1",
  "Acquirer": "#E04F2F"
};

function uniq(arr){ return Array.from(new Set(arr)); }

function getSeries(){
  const s = uniq(DATA.map(d => d.series));
  return s.length ? s : ["Series A","Series B"];
}

function renderLegend(series){
  const container = document.getElementById("legend");
  container.innerHTML = "";
  series.forEach(name => {
    const item = document.createElement("div");
    item.className = "legend-item";
    const sw = document.createElement("span");
    sw.className = "swatch";
    sw.style.background = SERIES_COLORS[name] || "#888";
    const label = document.createElement("span");
    label.textContent = name;
    item.appendChild(sw);
    item.appendChild(label);
    container.appendChild(item);
  });
}

function barPath(x0, x1, yCenter, h){
  const yTop = yCenter - h/2;
  const yBot = yCenter + h/2;
  const width = Math.max(0, x1 - x0);
  const r = Math.min(8, h/2, width/2);
  if(width <= 0){
    return `M ${x0} ${yTop} L ${x0} ${yBot} L ${x0} ${yBot} Z`;
  }
  return `M ${x0} ${yTop} L ${x1 - r} ${yTop} A ${r} ${r} 0 0 1 ${x1} ${yTop + r} L ${x1} ${yBot - r} A ${r} ${r} 0 0 1 ${x1 - r} ${yBot} L ${x0} ${yBot} Z`;
}

let chartState = { svg:null, g:null, x:null, y:null, y1:null, yAxisGroup:null, bgLayer:null, rowBG:null, width:0, height:0, margin:null, bars:null };

function createChart(){
  const series = getSeries();
  renderLegend(series);

  const legendEl = document.getElementById("legend");
  const legendH = legendEl ? legendEl.offsetHeight : 0;
  const extraBottomSpace = Math.max(30, Math.round(window.innerHeight * 0.06));

  d3.select("#chart").selectAll("*").remove();

  const groups = uniq(DATA.map(d => d.id));
  const containerWidth = Math.max(window.innerWidth, 320);
  const containerHeight = Math.max(window.innerHeight - legendH - extraBottomSpace, 240);
  const sizeFactor = Math.max(0.6, Math.min(1.15, Math.min(containerWidth/900, containerHeight/650)));
  const axisFS = Math.max(9, Math.round(20 * sizeFactor));
  const valueFSMin = Math.max(9, Math.round(12 * sizeFactor));

  // medir ancho de labels Y
  const tempSvg = d3.select("body").append("svg").style("visibility","hidden");
  const tempText = tempSvg.append("text").style("font-family","sans-serif").style("font-size", axisFS + "px").style("font-weight","bold");
  let maxLabelWidth = 0;
  groups.forEach(name => { tempText.text(name); const w = tempText.node().getBBox().width; maxLabelWidth = Math.max(maxLabelWidth, w); });
  tempSvg.remove();

  const margin = { top:12, right:Math.max(100, Math.min(180, Math.floor(containerWidth * 0.16))), bottom:Math.max(60, 80 * sizeFactor), left:Math.ceil(maxLabelWidth + 16) };
  const width = containerWidth - margin.left - margin.right;
  const maxRowsH = containerHeight - margin.top - margin.bottom;
  const height = Math.max(140, maxRowsH);

  const svg = d3.select("#chart")
    .attr("width", containerWidth)
    .attr("height", height + margin.top + margin.bottom)
    .attr("viewBox", `0 0 ${containerWidth} ${height + margin.top + margin.bottom}`)
    .style("width", "100%")
    .style("height", (height + margin.top + margin.bottom) + "px");

  chartState.svg = svg;
  chartState.width = width;
  chartState.height = height;
  chartState.margin = margin;

  const g = svg.append("g").attr("transform", `translate(${margin.left},${margin.top})`);
  const bgLayer = g.append("g").attr("class","bg-layer");
  chartState.bgLayer = bgLayer;

  const xMax = Math.max(1, d3.max(DATA, d => d.y) || 1);
  const x = d3.scaleSqrt().domain([0, xMax]).range([0, width]);
  const y = d3.scaleBand().domain(groups).range([0, height]).padding(0.25);

  // escala interna por serie (para agrupar barras dentro de cada fila)
  const y1 = d3.scaleBand().domain(series).range([0, y.bandwidth()]).padding(0.15);

  chartState.x = x;
  chartState.y = y;
  chartState.y1 = y1;

  // filas alternadas
  const step = y.step();
  const padGap = (step - y.bandwidth()) / 2;
  const rowIdx = d3.range(groups.length);
  chartState.rowBG = bgLayer.selectAll("rect.row-bg").data(rowIdx, d=>d).enter().append("rect")
    .attr("class","row-bg")
    .attr("x", -margin.left)
    .attr("y", i => y(groups[i]) - padGap)
    .attr("width", width + margin.left + margin.right)
    .attr("height", step)
    .attr("fill", (d,i) => i % 2 ? "#f5f5f5" : "#ffffff")
    .attr("pointer-events","none")
    .lower();

  // ejes
  const yAxis = d3.axisLeft(y).tickSize(0).tickPadding(2);
  chartState.yAxisGroup = g.append("g").attr("class", "axis").call(yAxis);
  chartState.yAxisGroup.selectAll("text").style("font-size", axisFS + "px").style("font-weight","bold");

  const usdFormat = v => {
  if (v >= 1e9) {
    return "$" + (v / 1e9).toFixed(2).replace(/\.00$/, "") + "B";
  } else if (v >= 1e6) {
    return "$" + (v / 1e6).toFixed(2).replace(/\.00$/, "") + "M";
  } else if (v >= 1e3) {
    return "$" + (v / 1e3).toFixed(2).replace(/\.00$/, "") + "K";
  }
  return "$" + v;
};

  const xAxis = d3.axisBottom(x).tickFormat(usdFormat).ticks(5);
  g.append("g").attr("class", "axis").attr("transform", `translate(0,${height})`).call(xAxis);
  g.selectAll("g.axis:last-of-type text").style("font-size", axisFS + "px");

  g.append("text")
    .attr("transform", `translate(${width / 2}, ${height + 45})`)
    .style("text-anchor", "middle")
    .style("font-size", axisFS + "px")
    .style("fill", "#666")
    .text("Amount(USD)");

  // dibujar barras (agrupadas)
  const barH = y1.bandwidth();
  const dataKey = d => d.id + "||" + d.series;

  chartState.bars = g.selectAll("path.bar")
    .data(DATA, dataKey)
    .enter()
    .append("path")
    .attr("class","bar")
    .attr("d", d => {
      const yCenter = y(d.id) + y1(d.series) + barH/2;
      return barPath(0, x(d.y), yCenter, barH);
    })
    .attr("fill", d => SERIES_COLORS[d.series] || "#888")
    .attr("fill-opacity", 0.9);

    
const LABEL_ACCESSOR = d => d.customValue ?? d.y;      // cámbialo a lo que quieras
const LABEL_FORMAT   = v => (typeof v === "number" ? d3.format("~s")(v) : String(v));

  // etiquetas de valor
  g.selectAll("text.value")
    .data(DATA, dataKey)
    .enter()
    .append("text")
    .attr("class","value")
    .attr("x", d => Math.min(x(d.y) + 6, width - 4))
    .attr("y", d => y(d.id) + y1(d.series) + barH/2)
    .attr("text-anchor","start")
    .attr("dominant-baseline","middle")
    .attr("font-size", Math.max(valueFSMin, Math.round(y.bandwidth() * 0.25)) + "px")
    .attr("font-weight","600")
    .attr("fill","#000")
    .text(d => d.label);
}

createChart();
let resizeTimeout;
window.addEventListener('resize', ()=>{clearTimeout(resizeTimeout); resizeTimeout = setTimeout(()=>{createChart();}, 250);});
</script>

<a href="https://aiworld.eu/" target="_blank" rel="noopener">
  <img src="https://aiworld.eu/logo-transparent.svg" class="logo" alt="AI World logo"/>
</a>
<div class="source-text">Source: <a href="crunchbase.com" target="_blank" rel="noopener"> Crunchbase</a></div>
</body>
</html>
